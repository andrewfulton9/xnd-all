

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="index,follow" name="robots" />
<meta content="libndtypes documentation" name="description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data structures &mdash; Plures v0.2.0dev3 documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://xnd.io/libgumath/data-structures.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Functions" href="functions.html" />
    <link rel="prev" title="libgumath" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/xndlogo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                v0.2.0dev3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../libxnd/index.html">libxnd</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../xnd/index.html">xnd</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">libgumath</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Data structures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#kernel-signatures">Kernel signatures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kernel-set">Kernel set</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kernel-set-initialization">Kernel set initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multimethod-struct">Multimethod struct</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernels.html">Builtin kernels</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gumath/index.html">gumath</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../xndtools/index.html">xndtools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">Releases</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Plures</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">libgumath</a> &raquo;</li>
        
      <li>Data structures</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-structures">
<h1>Data structures<a class="headerlink" href="#data-structures" title="Permalink to this headline">¶</a></h1>
<p>libgumath is a lightweight library for managing and dispatching computational
kernels that target XND containers.</p>
<p>Functions are multimethods in a lookup table. Typically, applications that
use libgumath should create a new lookup table for each namespace. For example,
Python modules generally should have a module-specific lookup table.</p>
<div class="section" id="kernel-signatures">
<h2>Kernel signatures<a class="headerlink" href="#kernel-signatures" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate" id="std:topic-kernels"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span> <span class="n">gm_xnd_kernel_t</span><span class="p">)(</span><span class="n">xnd_t</span> <span class="n">stack</span><span class="p">[],</span> <span class="n">ndt_context_t</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
</pre></div>
</div>
<p>The signature of an <em>xnd</em> kernel. <em>stack</em> contains incoming and outgoing
arguments. In case of an error, kernels are expected to set a context error
message and return <em>-1</em>.</p>
<p>In case of success, the return value is <em>0</em>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span> <span class="n">gm_strided_kernel_t</span><span class="p">)(</span><span class="kt">char</span> <span class="o">**</span><span class="n">args</span><span class="p">,</span> <span class="kt">intptr_t</span> <span class="o">*</span><span class="n">dimensions</span><span class="p">,</span> <span class="kt">intptr_t</span> <span class="o">*</span><span class="n">steps</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
</pre></div>
</div>
<p>The signature of a NumPy compatible kernel.  These signatures are for
applications that want to use existing NumPy compatible kernels on XND
containers.</p>
<p>XND containers are automatically converted to a temporary ndarray before
kernel application.</p>
</div>
<div class="section" id="kernel-set">
<h2>Kernel set<a class="headerlink" href="#kernel-set" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Collection of specialized kernels for a single function signature. */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
   <span class="n">ndt_t</span> <span class="o">*</span><span class="n">sig</span><span class="p">;</span>
   <span class="k">const</span> <span class="n">ndt_constraint_t</span> <span class="o">*</span><span class="n">constraint</span><span class="p">;</span>

   <span class="cm">/* Xnd signatures */</span>
   <span class="n">gm_xnd_kernel_t</span> <span class="n">C</span><span class="p">;</span>       <span class="cm">/* dispatch ensures c-contiguous */</span>
   <span class="n">gm_xnd_kernel_t</span> <span class="n">Fortran</span><span class="p">;</span> <span class="cm">/* dispatch ensures f-contiguous */</span>
   <span class="n">gm_xnd_kernel_t</span> <span class="n">Xnd</span><span class="p">;</span>     <span class="cm">/* selected if non-contiguous or both C and Fortran are NULL */</span>

   <span class="cm">/* NumPy signature */</span>
   <span class="n">gm_strided_kernel_t</span> <span class="n">Strided</span><span class="p">;</span>
<span class="p">}</span> <span class="n">gm_kernel_set_t</span><span class="p">;</span>
</pre></div>
</div>
<p>A kernel set contains the function signature, an optional constraint function,
and up to four specialized kernels, each of which may be <em>NULL</em>.</p>
<p>The dispatch calls the kernels in the following order of preference:</p>
<p>If the inner dimensions of the incoming arguments are C-contiguous, the <em>C</em>
kernel is called first. In case of <em>Fortran</em> inner dimensions, <em>Fortran</em>
is called first.</p>
<p>If an <em>Xnd</em> kernel is present, it is called next, then the <em>Strided</em> kernel.</p>
</div>
<div class="section" id="kernel-set-initialization">
<h2>Kernel set initialization<a class="headerlink" href="#kernel-set-initialization" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate" id="std:topic-kernel set initialization"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sig</span><span class="p">;</span>
   <span class="k">const</span> <span class="n">ndt_constraint_t</span> <span class="o">*</span><span class="n">constraint</span><span class="p">;</span>

   <span class="n">gm_xnd_kernel_t</span> <span class="n">C</span><span class="p">;</span>
   <span class="n">gm_xnd_kernel_t</span> <span class="n">Fortran</span><span class="p">;</span>
   <span class="n">gm_xnd_kernel_t</span> <span class="n">Xnd</span><span class="p">;</span>
   <span class="n">gm_strided_kernel_t</span> <span class="n">Strided</span><span class="p">;</span>
<span class="p">}</span> <span class="n">gm_kernel_init_t</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">gm_add_kernel</span><span class="p">(</span><span class="n">gm_tbl_t</span> <span class="o">*</span><span class="n">tbl</span><span class="p">,</span> <span class="k">const</span> <span class="n">gm_kernel_init_t</span> <span class="o">*</span><span class="n">kernel</span><span class="p">,</span> <span class="n">ndt_context_t</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
</pre></div>
</div>
<p>The <em>gm_kernel_init_t</em> is used for initializing a kernel set.  Usually, a C
translation unit contains an array of hundreds of <em>gm_kernel_init_t</em> structs
together with a function that initializes a specific lookup table.</p>
</div>
<div class="section" id="multimethod-struct">
<h2>Multimethod struct<a class="headerlink" href="#multimethod-struct" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate" id="std:topic-multimethod struct"><div class="highlight"><pre><span></span><span class="cm">/* Multimethod with associated kernels */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">gm_func</span> <span class="n">gm_func_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">const</span> <span class="n">gm_kernel_set_t</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">gm_typecheck_t</span><span class="p">)(</span><span class="n">ndt_apply_spec_t</span> <span class="o">*</span><span class="n">spec</span><span class="p">,</span>
                  <span class="k">const</span> <span class="n">gm_func_t</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="k">const</span> <span class="n">ndt_t</span> <span class="o">*</span><span class="n">in</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">nin</span><span class="p">,</span> <span class="n">ndt_context_t</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">gm_func</span> <span class="p">{</span>
   <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
   <span class="n">gm_typecheck_t</span> <span class="n">typecheck</span><span class="p">;</span> <span class="cm">/* Experimental optimized type-checking, may be NULL. */</span>
   <span class="kt">int</span> <span class="n">nkernels</span><span class="p">;</span>
   <span class="n">gm_kernel_set_t</span> <span class="n">kernels</span><span class="p">[</span><span class="n">GM_MAX_KERNELS</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</div>
<p>This is the multimethod struct for a given function name.  Each multimethod has
a <em>nkernels</em> associated kernel sets with unique type signatures.</p>
<p>If <em>typecheck</em> is <em>NULL</em>, the generic libndtypes multimethod dispatch is used
to locate the kernel. This is an O(N) operation, whose search time is negligible
for large array operations.</p>
<p>The <em>typecheck</em> field can be set to an optimized lookup function that has
internal knowledge of kernel set locations.  The only restriction to the
function is that it must behave exactly as the generic libndtypes typecheck.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="functions.html" class="btn btn-neutral float-right" title="Functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="libgumath" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, Plures Project
      <span class="lastupdated">
        Last updated on True.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>